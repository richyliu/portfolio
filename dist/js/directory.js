var list=!1,scoutArrayKeymap=[["scout","firstName"],["scout","lastName"],["scout","email"],["scout","homePhone"],["scout","slack"],["scout","joinDate"],["scout","active"],["scout","WFATrained"],["scout","school"],["scout","cellPhone"],["father","firstName"],["father","lastName"],["father","cellPhone"],["father","email"],["father","slack"],["mother","firstName"],["mother","lastName"],["mother","cellPhone"],["mother","email"],["mother","slack"]];function getSlackLink(e,t,o,a){firebase.database().ref("/directory/slackUID/").once("value").then(function(r){var s=r.val(),l=encodeUsername(e);null==s||null==s[l]||void 0==s[l]?$.ajax({url:`https://slack.com/api/users.list?token=${t}`,method:"GET",dataType:"json"}).done(function(t){var r=t.members,s={};for(i=0;i<r.length;i++)r[i].deleted||(""!=r[i].profile.display_name&&void 0!=r[i].profile.display_name?displayName=r[i].profile.display_name:displayName=r[i].profile.real_name,s[encodeUsername(displayName)]=r[i].id,displayName==e&&o(r[i].id,e,truea,a));firebase.database().ref("/directory/slackUID/").update(s)}):o(s[l],e,!1,a)})}function encodeUsername(e){return encodeURIComponent(e).replaceAll(".","%2E")}function decodeUsername(e){return decodeURIComponent(e)}function onhashchange(e,t){if(""!=window.location.hash){var o=parseInt(window.location.hash.substring(1),10);if(!(Number.isNaN(o)||o<0||o>=e.length)){var a,r=["scout","father","mother"];for(i=0;i<3;i++)console.log(i),console.log(".infoModal-"+r[i]+"SlackDMLink"),console.log(e[o][r[i]].slack),console.log(JSON.parse(JSON.stringify(e[o][r[i]]))),""==e[o][r[i]].slack||void 0==e[o][r[i]].slack?(console.log("HA107UNDEF"+r[i]),console.log(".infoModal-"+r[i]+"SlackUsername"),$(".infoModal-"+r[i]+"SlackDMLink").attr("href",null),$(".infoModal-"+r[i]+"SlackUsername").html("<i>Not listed in spreadsheet</i>"),$(".infoModal-"+r[i]+"SlackDMLoadingText").text("")):"none"==e[o][r[i]].slack.toLowerCase()?(console.log(".infoModal-"+r[i]+"SlackUsername"),console.log("HA107NONE"+r[i]),$(".infoModal-"+r[i]+"SlackDMLink").attr("href",null),$(".infoModal-"+r[i]+"SlackUsername").html("<i>None</i>"),$(".infoModal-"+r[i]+"SlackDMLoadingText").text("")):(console.log("HA107"+r[i]),$(".infoModal-"+r[i]+"SlackUsername").text("@"+e[o][r[i]].slack),$(".infoModal-"+r[i]+"SlackDMLoadingText").text("(profile loading...)"),getSlackLink(e[o][r[i]].slack,t.slackToken,function(e,t,o,a){console.log(e),console.log(".infoModal-"+r[a]+"SlackDMLink"),$(".infoModal-"+r[a]+"SlackDMLink").attr("href","https://t485.slack.com/messages/message/team/"+e),$(".infoModal-"+r[a]+"SlackDMLoadingText").text("")},i));for(var s=0;s<scoutArrayKeymap.length;s++){a=e[o][scoutArrayKeymap[s][0]][scoutArrayKeymap[s][1]],console.log("TraitText:"),console.log(a),console.log(scoutArrayKeymap[s][1]),$(".infoModal-"+scoutArrayKeymap[s][0]+scoutArrayKeymap[s][1].substring(0,1).toUpperCase()+scoutArrayKeymap[s][1].substring(1)+"Link").attr("href",null),void 0==a||""==a?a="Not listed in spreadsheet.":"active"==scoutArrayKeymap[s][1]||"WFATrained"==scoutArrayKeymap[s][1]?a="Y"==a||"y"==a?"Yes":"N"==a||"n"==a?"No":"R"==a||"r"==a?"Rarely":a:"email"==scoutArrayKeymap[s][1]||"Email"==scoutArrayKeymap[s][1]?$(".infoModal-"+scoutArrayKeymap[s][0]+scoutArrayKeymap[s][1].substring(0,1).toUpperCase()+scoutArrayKeymap[s][1].substring(1)+"Link").attr("href","mailto:"+a):"cellPhone"!=scoutArrayKeymap[s][1]&&"CellPhone"!=scoutArrayKeymap[s][1]&&"homePhone"!=scoutArrayKeymap[s][1]&&"HomePhone"!=scoutArrayKeymap[s][1]||($(".infoModal-"+scoutArrayKeymap[s][0]+scoutArrayKeymap[s][1].substring(0,1).toUpperCase()+scoutArrayKeymap[s][1].substring(1)+"Link").attr("href",""==a.replace(/\D/g,"")?null:"tel:"+a.replace(/\D/g,"")),console.log(""==a.replace(/\D/g,"")?null:"tel:"+a.replace(/\D/g,"")));scoutArrayKeymap[s][1];console.log(".infoModal-"+scoutArrayKeymap[s][0]+scoutArrayKeymap[s][1].substring(0,1).toUpperCase()+scoutArrayKeymap[s][1].substring(1)),$(".infoModal-"+scoutArrayKeymap[s][0]+scoutArrayKeymap[s][1].substring(0,1).toUpperCase()+scoutArrayKeymap[s][1].substring(1)).text(a)}for(i=0;i<r.length;i++)void 0==e[o][r[i]].firstName||""==e[o][r[i]].firstName||void 0==e[o][r[i]].lastName||""==e[o][r[i]].lastName?($(".infoModal-"+r[i]+"FullNameElement").addClass("hidden"),$(".infoModal-"+r[i]+"FirstNameElement").removeClass("hidden"),$(".infoModal-"+r[i]+"LastNameElement").removeClass("hidden")):$(".infoModal-"+r[i]+"FullName").text(e[o][r[i]].firstName+" "+e[o][r[i]].lastName);$("#infoModal").modal("show")}}}function getColVisibility(e){return $("#filter-select").val().map(e=>parseInt(e,10)).indexOf(e)>-1}function filterselectchange(){var e=$("#filter-select").val().map(e=>parseInt(e,10)),t=[];for(i=0;i<21;i++)e.indexOf(i)>-1?($(".col"+i).removeClass("hidden"),t.push(i)):$(".col"+i).addClass("hidden");var o=[0,1,2,3,4,10],a=!1;if(e.length==o.length)for(i=0;i<o.length&&o.indexOf(e[i])>-1;i++)i==o.length-1&&(a=!0);a?setURLQuery(setQuery("filter",null)):setURLQuery(setQuery("filter",t.join(",")))}function processURLOptions(){var e={filter:getQuery("filter")&&getQuery("filter").length>0?getQuery("filter").split(",").map(e=>parseInt(e,10)):void 0,sortby:parseInt(getQuery("sortby"),10),sortorder:getQuery("sortorder")};checkDefaultOptions(),setOptions(merge({sortby:1,sortorder:"asc",filter:[0,1,2,3,4,10]},e))}function checkDefaultOptions(){var e=1,t="asc",o=[0,1,2,3,4,10],a=getQuery("filter")&&getQuery("filter").length>0?getQuery("filter").split(",").map(e=>parseInt(e,10)):void 0,r=Number.isInteger(parseInt(getQuery("sortby"),10))?parseInt(getQuery("sortby"),10):getQuery("sortby"),s=getQuery("sortorder"),i=a==o||""==a||null==a,l=r==e||""==r||null==r,n=s==t||""==s||null==s,c=""==$("#search").val()||null==$("#search").val();i&&l&&n&&c?(history.pushState("",document.title,window.location.pathname+window.location.hash),$("#modified-settings").addClass("hidden")):$("#modified-settings").removeClass("hidden")}function merge(e,t){for(var o in t)t.hasOwnProperty(o)&&null!==t[o]&&void 0!==t[o]&&""!=t[o]&&(e[o]=t[o]);return e}function setOptions(e){for(i=0;i<=20;i++)$("#filter-select option[value="+i+"]").attr("selected",e.filter.indexOf(i)>-1?"":null);for($("#filter-select").selectpicker("refresh"),filterselectchange(),i=0;i<=20;i++)$("#sortby-select option[value="+i+"]").attr("selected",e.sortby==i?"":null);$("#sortby-select").selectpicker("refresh"),$("#sortby-select").trigger("change"),$("#sortorder-select option[value="+e.sortorder+"]").attr("selected",""),$("#sortorder-select option[value="+("asc"==e.sortorder?"desc":"asc")+"]").attr("selected",null),$("#sortorder-select").selectpicker("refresh"),$("#sortorder-select").trigger("change"),list&&(list.search($("#search").val()),list.sort("col"+$("#sortby-select").val(),{order:$("#sortorder-select").val()})),console.log("setOptions"),$("#search").val(getQuery("query")),$("#search").trigger("keyup")}firebase.database().ref("/directory/keys/").once("value").then(function(e){var t=e.val();for($(".link-google-sheet-dir").attr("href",`https://docs.google.com/spreadsheets/d/${t.id}/edit`),rangeString="",i=0;i<t.sheets.length;i++)rangeString+=`ranges=${t.sheets[i]}!A2:U&`;$.ajax({url:`https://sheets.googleapis.com/v4/spreadsheets/${t.id}/values:batchGet/?${rangeString}majorDimension=ROWS&valueRenderOption=FORMATTED_VALUE&key=${t.api}`,method:"GET",dataType:"json"}).done(function(e){$("#loading-text").addClass("hidden");var o=e.valueRanges,a=[["scout","firstName"],["scout","lastName"],["scout","email"],["scout","homePhone"],["scout","slack"],["scout","job"],["scout","joinDate"],["scout","active"],["scout","WFATrained"],["scout","school"],["scout","cellPhone"],["father","firstName"],["father","lastName"],["father","cellPhone"],["father","email"],["father","slack"],["mother","firstName"],["mother","lastName"],["mother","cellPhone"],["mother","email"],["mother","slack"]],r=[],s=0;for(i=0;i<o.length;i++){var l=o[i].values,n=t.sheets[i];for(j=0;j<l.length;j++){var c="<tr class='table-row'>";r[s]={scout:{},father:{},mother:{}};var d=0;for(k=0;k<l[j].length+1;k++)2!=k?(getColVisibility(k)?hidden="":hidden="hidden",c+="<td class='col"+k+" "+hidden+"' data-col='"+k+"' data-row='"+s+"'>"+l[j][d]+"</td>",r[s][a[d][0]][a[d][1]]=l[j][d],d++):(getColVisibility(k)?hidden="":hidden="hidden",c+="<td class='col"+k+" "+hidden+"' data-col='"+k+"' data-row='"+s+"'>"+n+"</td>",r[s][a[d][0]][a[d][1]]=n);c+="</tr>",s++,$("#dir-body").append(c)}console.log(r)}$("#table").on("click",".table-row",function(e){var t=$(e.target).attr("data-row");window.location.hash=t}),$(window).on("hashchange",function(){onhashchange(r,t)}),$(document).ready(function(){onhashchange(r,t)});var u=[];for(i=0;i<l[0].length+1;i++)u.push("col"+i);(list=new List("directory-list",{valueNames:u})).search($("#search").val()),list.sort("col"+$("#sortby-select").val(),{order:$("#sortorder-select").val()}),$("#sortby-select, #sortorder-select").change(function(){list.sort("col"+$("#sortby-select").val(),{order:$("#sortorder-select").val()}),setURLQuery(setQuery("sortby",$("#sortby-select").val())),setURLQuery(setQuery("sortorder",$("#sortorder-select").val()))})})}),$(document).ready(function(){processURLOptions(),$("#infoModal").on("hide.bs.modal",function(){history.pushState("",document.title,window.location.pathname+window.location.search)})}),$("#filter-select").change(filterselectchange),$("#search").keyup(function(){setURLQuery(setQuery("query",encodeURIComponent($("#search").val())))}),/Android|webOS|iPhone|iPad|iPod|BlackBerry/i.test(navigator.userAgent)&&$(".selectpicker").selectpicker("mobile");