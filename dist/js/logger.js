"use strict";var Logger={getDebugLog:function(){return["Debug log created","Debug log sent"]}};$(document).ready(function(){$(window).on("hashchange",function(){"#feedback"==window.location.hash&&$("#feedback-modal").modal("show")}).trigger("hashchange")}),$("#feedback-btn").click(function(){window.location.hash="#feedback",$("#feedback-modal").modal("show")}),$("#feedback-modal").on("hidden.bs.modal",function(){"#feedback"==window.location.hash&&removeHash()}),$("#bug-affected-pages").val(window.location.href),$("#issueType").change(function(){let e=$(this).val();$(".feedback-section:not(.feedback-"+e+")").collapse("hide"),$(".feedback-"+e).collapse("show"),$(".feedback-hide.feedback-"+e+"-hide").addClass("hidden"),$(".feedback-hide:not(.feedback-"+e+"-hide)").removeClass("hidden")});let getInfo=function(){return{userAgent:window.navigator.userAgent,browserByDuckTyping:window.chrome&&window.chrome.webstore?"Google Chrome":"undefined"!=typeof InstallTrigger?"Mozilla Firefox":/constructor/i.test(window.HTMLElement)||"[object SafariRemoteNotification]"===(!window.safari||"undefined"!=typeof safari&&safari.pushNotification).toString()?"Safari":window.opr&&opr.addons||window.opera||navigator.userAgent.indexOf(" OPR/")>=0?"Opera":document.documentMode?"Internet Explorer":!isIE&&window.StyleMedia?"Edge":(isChrome||isOpera)&&window.CSS?"Blink":"Unknown",platform:window.navigator.platform,detectedOS:(e=window.navigator.userAgent,a=window.navigator.platform,n=null,-1!==["Macintosh","MacIntel","MacPPC","Mac68K"].indexOf(a)?n="Mac OS":-1!==["iPhone","iPad","iPod"].indexOf(a)?n="iOS":-1!==["Win32","Win64","Windows","WinCE"].indexOf(a)?n="Windows":/Android/.test(e)?n="Android":!n&&/Linux/.test(a)&&(n="Linux"),n),navigator:{appCodeName:navigator.appCodeName,appName:navigator.appName,appVersion:navigator.appVersion,doNotTrack:navigator.doNotTrack,language:navigator.language,languages:navigator.languages,platform:navigator.platform,online:navigator.onLine,product:navigator.product,userAgent:navigator.userAgent,vendor:navigator.vendor}};var e,a,n},bugFields=[{name:"title",validation:/^(.|\n){10,150}$/,maxLength:150,minLength:10},{name:"description",validation:/^(.|\n){0,5000}$/,maxLength:5e3,minLength:0},{name:"affected-pages",validation:/^(.|\n){0,500}$/,maxLength:500,minLength:0},{name:"name",validation:/^(.|\n){3,100}$/,general:!0},{name:"email",validation:/^(?:[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*|"(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21\x23-\x5b\x5d-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])*")@(?:(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?|\[(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?|[a-z0-9-]*[a-z0-9]:(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21-\x5a\x53-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])+)\])$/,general:!0}];for(let e=0;e<bugFields.length;e++){let a=function(){let a=$("#"+(bugFields[e].general?"":"bug-")+bugFields[e].name).val(),n=a.length;if(void 0!==bugFields[e].maxLength&&void 0!==bugFields[e].minLength){let a=n>=bugFields[e].minLength;$("#"+(bugFields[e].general?"":"bug-")+bugFields[e].name+"-unit").text(a?" / "+bugFields[e].maxLength:" characters to go"),$("#"+(bugFields[e].general?"":"bug-")+bugFields[e].name+"-length").text(a?n:bugFields[e].minLength-n)}let i=bugFields[e].validation.test(a);i&&!0!==bugFields[e].wasValid?bugFields[e].wasValid=!0:i||!0!==bugFields[e].wasValid?$("#"+(bugFields[e].general?"":"bug-")+bugFields[e].name).hasClass("is-invalid")&&$("#"+(bugFields[e].general?"":"bug-")+bugFields[e].name).removeClass("is-invalid"):$("#"+(bugFields[e].general?"":"bug-")+bugFields[e].name).addClass("is-invalid")};$("#"+(bugFields[e].general?"":"bug-")+bugFields[e].name).on("change paste keyup",a),a()}let getExtensionFromFilename=function(e){return e.slice((Math.max(0,e.lastIndexOf("."))||1/0)+1)},roundTo=function(e,a){void 0===a&&(a=0);let n=Math.pow(10,a);return e=parseFloat((e*n).toFixed(11)),Math.round(e)/n},setProgress=function(e){e=roundTo(e,2),$("#feedback-progressbar").css("width",e+"%"),$("#feedback-progressbar").html(e+"%"),$("#feedback-progressbar").attr("aria-valuenow",e+"%")},upload=function(e,a,n){null==e&&n({url:"",name:"",size:"",type:"not uploaded",storageRef:""},firebase.database().ref("/feedback/"+a+"/").push());var i={contentType:e.type},o=firebase.storage().ref(),t=firebase.database().ref("/feedback/"+a+"/").push(),l=o.child("/feedback/"+a+"/files/"+t.key).put(e,i);$("#upload-control, #feedback-progress").removeClass("hidden"),$("#upload-control-pause").click(function(){l.pause(),$("#upload-control-pause").addClass("hidden"),$("#upload-control-resume").removeClass("hidden")}),$("#upload-control-resume").click(function(){l.resume(),$("#upload-control-resume").addClass("hidden"),$("#upload-control-pause").removeClass("hidden")}),$("#upload-control-cancel").click(function(){l.cancel(),$(".uploading-show, #feedback-loading").addClass("hidden"),$(".uploading-hide, #feedback-main").removeClass("hidden")}),l.on(firebase.storage.TaskEvent.STATE_CHANGED,function(e){var a=e.bytesTransferred/e.totalBytes*100;switch(a=Math.round(100*a)/100*.85,setProgress(a),e.state){case firebase.storage.TaskState.PAUSED:$("#upload-control-play").addClass("hidden"),$("#upload-control-resume").removeClass("hidden");break;case firebase.storage.TaskState.RUNNING:$("#upload-control-resume").addClass("hidden"),$("#upload-control-play").removeClass("hidden")}},function(e){switch(e.code){case"storage/canceled":break;case"storage/cannot-slice-blob":$("#feedback-modal .modal-body").addClass("hidden"),$("#feedback-filechangederror").removeClass("hidden");break;default:$("#feedback-error-data").html(btoa(JSON.stringify(e)))}},function(){l.snapshot.ref.getDownloadURL().then(function(i){n({url:i,name:e.name,size:e.size,type:e.type,storageRef:"/feedback/"+a+"/files/"+t.key},t)})})};$("#feedback-submit").click(function(){let e=function(e,a){firebase.database().ref("/feedback/keys/").once("value").then(function(n){setProgress(90);var i=n.val().github,o=n.val().slack.webhookurl;let t="";"image"==e.fileType.split("/")[0]?t=`![User uploaded image: ${e.fileUrl}](${e.fileUrl}) "\\\\n\\\\n ------- \\\\n"`:null!=e.fileUrl&&(t="User Uploaded File URL: "+e.fileUrl+"\\n\\n ------- \\n");let l="";e.pages&&(l="**Affected pages**:\\n```"+e.pages+"\\n```\\n");let d=null!=e.body?e.body+"\\n ------- \\n":"";var s="bug"==e.type?"bug report":"feedback",r="Data from "+s+" modal submitted by **"+e.name+"**:\\n\\n| Timestamp | Device | Browser | Type |\\n|---|---|---|---|\\n| "+new Date+" | "+e.os+" | "+e.browser+" | "+e.type+" | \\n\\n"+l+t+d+"This report automatically created from the [t485.org](https://t485.org) feedback form.",g=`{"title": "${e.title}", "body": "${r}", "labels":["${"feedback"==s?"enhancement":s}"] }`;$.ajax({accepts:{json:"application/vnd.github.v3+json","*":"application/vnd.github.v3+json"},url:"https://api.github.com/repos/t485/t485/issues?access_token="+i,data:g,type:"POST"}).always(function(e){$.ajax({url:o,data:"payload="+JSON.stringify({text:`New ${s} filed: `+e.url}),type:"POST"}).always(function(n){a(e.url)})})})},a=function(){$(".uploading-hide").addClass("hidden"),$(".uploading-show").removeClass("hidden"),$("#feedback-modal").modal({backdrop:"static",keyboard:!1})},n=$("#issueType").val();switch(n){case"bug":!function(a){let i=!1;for(let e=0;e<bugFields.length;e++){let a=!0===bugFields[e].general?$("#"+bugFields[e].name).val():$("#bug-"+bugFields[e].name).val();bugFields[e].validation.test(a)||(i=!0,$((bugFields[e].general?"#":"#bug-")+bugFields[e].name).addClass("is-invalid"))}var o=$("#bug-file")[0].files[0];o&&o.size>105906176&&($("#bug-file").addClass("is-invalid"),$("#bug-file-group invalid-feedback").removeClass(""),i=!0),i||(a(),$("#feedback-main").addClass("hidden"),$("#feedback-loading").removeClass("hidden"),$("#feedback-progressbar").css("width","0%"),$("#feedback-progressbar").html("0%"),$("#feedback-progressbar").attr("aria-valuenow","0%"),upload(o,"bug",function(a,i){e({name:$("#name").val(),os:getInfo().detectedOS,browser:getInfo().browserByDuckTyping,pages:$("#"+n+"-affected-pages").val(),body:$("#"+n+"-description").val(),title:$("#"+n+"-title").val(),type:n,fileUrl:a.url,fileType:a.type},function(e){setProgress(95);let a=firebase.auth().currentUser,o={};return o.loggedIn=null!==a,o.loggedIn&&(o={id:a.uid||"Not Logged In",email:a.email,displayName:a.displayName}),console.log("/feedback/reports/"+n+"/"+i.key)})}))}(a);break;case"feature":a()}}),$(".custom-file-input").on("change",function(){var e=$(this).val();e=e.substring(e.lastIndexOf("\\")+1),$("#bug-file").hasClass("is-invalid")&&$("#bug-file").removeClass("is-invalid"),$(this).next(".custom-file-label").css("white-space: nowrap;overflow:hidden;"),$(this).next(".custom-file-label").html(e)}),$("#bug-file-clear").click(function(){$("#bug-file").val(null),$("#bug-file").next(".custom-file-label").html("Choose File")}),Logger.log=function(){};